
name: Test

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    name: A job to run test in FreeBSD
    strategy:
      matrix:
        version: ["14.0", "13.2"]
    steps:
    - uses: actions/checkout@v4
    - name: Test in FreeBSD
      id: test
      uses: vmactions/freebsd-vm@v1
      with:
        release: ${{ matrix.version }}
        usesh: true
        prepare: |
          pkg install -y python3 bash cmake git gmake gsed libpcap tcpreplay

        run: |
          chmod a+rw /dev/bpf*
          cmake -S . -B Dist
          cmake --build Dist -j 2

          ifconfig

          ifconfig vtnet0 promisc

          python -m ensurepip
          python -m pip install -r ci/run_tests/requirements.txt
          python ci/run_tests/run_tests.py --interface vtnet0
          
          cd Tests/ExamplesTest
          python -m ensurepip
          python -m pip install -r requirements.txt
          python -m pytest --interface vtnet0 --root-path=../../Dist/examples_bin
